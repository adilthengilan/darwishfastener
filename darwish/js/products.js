// Products data
const productsData = [
    // Bolts
    {
      id: 1,
      name: " Din 912 - Allen Bolt",
      category: "bolts",
      material: "MS | GI | SS | Yellow",
      Grade: "10.9 | 12.9 | 316 | 304",
      // price: 0.25,
      image: "./assets/Din 912 - Allen Bolt.jfif",
      description: "Metric | UNC | UNF",
    }, {
      id: 2,
      name: " Din 7991 - Allen CSK Bolt",
      category: "bolts",
      material: "MS | GI | SS | Yellow",
      Grade: "10.9 | 12.9 | 316 | 304",
      // price: 0.25,
      image: "./assets/Din 7991 - Allen CSK Bolt.jfif",
      description: "Metric | UNC | UNF",
    },
    {
      id: 3,
      name: "Din 7380",
      category: "bolts",
      material: "MS | GI | SS | Yellow",
      Grade: "10.9 | 12.9 | 316 | 304",
      // price: 0.25,
      image: "./assets/Din 7380.jfif",
      description: "Metric | UNC | UNF",
    },
    {
      id: 4,
      name: " Din 7984 Low head allen bolt",
      category: "bolts",
      material: "MS | GI | SS",
      Grade: "8.8 | 316 | 316 | 304",
      // price: 0.25,
      image: "./assets/Din 7984 Low head allen bolt.jfif",
      description: "Metric",
    },
    {
      id: 5,
      name: " finneck Bolt",
      category: "bolts",
      material: "HDG",
      Grade: " 8.8",
      // price: 0.25,
      image: "./assets/finneck Bolt.jfif",
      description: "Metric",
    },
    {
      id: 6,
      name: "Din 6921 - flange bolt",
      category: "bolts",
      material: "MS | GI | SS | Yellow | DAC",
      Grade: "8.8 | 10.9 | 316 | 304",
      // price: 0.25,
      image: "./assets/Din 6921 - flange bolt.jfif",
      description: " Metric | UNC",
    },
    {
      id: 7,
      name: "Din 933 / 931Hexagon Bolt",
      category: "bolts",
      material: "MS | GI | SS | Yellow | Brass",
      Grade: "8.8 | 10.9 | 316 | 304",
      // price: 0.25,
      image: "./assets/1.jfif",
      description: "Metric | M. fine | UNC |UNF",
    },
    {
      id: 8,
      name: "heavy hexagon bolt",
      category: "bolts",
      material: "MS | HDG",
      Grade: " ASTM A325M",
      // price: 0.25,
      image: "./assets/heavy hexagon bolt.jfif",
      description: " Metric | UNC",
    },
    {
      id: 9,
      name: "heavy hexagon bolt",
      category: "bolts",
      material: " MS",
      Grade: " ASTM A490M",
      // price: 0.25,
      image: "./assets/heavy hexagon bolt1.jfif",
      description: " Metric",
    },
    {
      id: 10,
      name: "heavy hexagon bolt (friction grip)",
      category: "bolts",
      material: " MS | HDG",
      Grade: " ASTM 6914 (10.9)",
      // price: 0.25,
      image: "./assets/heavy hexagon bolt (friction grip).jfif",
      description: " Metric",
    },
    {
      id: 11,
      name: "Din 975 / 976-1 Threaded Rods",
      category: "bolts",
      material: "MS | GI | HDG | SS | Brass | Nylon",
      Grade: " 4.6 | 8.8 | 10.9 | 316 | 304 | B7",
      // price: 0.25,
      image: "./assets/2.jfif",
      description: " Metric | UNC | UNF",
    },
    {
      id: 12,
      name: " DIN 603 Carriage bolt",
      category: "bolts",
      material: "MS | GI | SS | HDG",
      Grade: " 8.8 | 316 | 304",
      // price: 0.25,
      image: "./assets/ DIN 603 Carriage bolt",
      description: "Metric | UNC",
    },
    {
      id: 13,
      name: " Din 7984 Low head allen bolt",
      category: "bolts",
      material: "MS | GI | SS | Yellow",
      Grade: "10.9 | 12.9 | 316 | 304",
      // price: 0.25,
      image: "./assets/ Din 7984 Low head allen bolt.jfif",
      description: "Metric | UNC | UNF",
    },
    {
      id: 14,
      name: " Din 7984 Low head allen bolt",
      category: "bolts",
      material: "MS | GI | SS | Yellow",
      Grade: "10.9 | 12.9 | 316 | 304",
      // price: 0.25,
      image: "./assets/ Din 7984 Low head allen bolt.jfif",
      description: "Metric | UNC | UNF",
    },
    {
      id: 15,
      name: " Din 7984 Low head allen bolt",
      category: "bolts",
      material: "MS | GI | SS | Yellow",
      Grade: "10.9 | 12.9 | 316 | 304",
      // price: 0.25,
      image: "./assets/ Din 7984 Low head allen bolt.jfif",
      description: "Metric | UNC | UNF",
    },
    {
      id: 16,
      name: " Din 7984 Low head allen bolt",
      category: "bolts",
      material: "MS | GI | SS | Yellow",
      Grade: "10.9 | 12.9 | 316 | 304",
      // price: 0.25,
      image: "./assets/ Din 7984 Low head allen bolt.jfif",
      description: "Metric | UNC | UNF",
    },
    {
      id: 17,
      name: " Din 7984 Low head allen bolt",
      category: "bolts",
      material: "MS | GI | SS | Yellow",
      Grade: "10.9 | 12.9 | 316 | 304",
      // price: 0.25,
      image: "./assets/ Din 7984 Low head allen bolt.jfif",
      description: "Metric | UNC | UNF",
    },
    {
      id: 18,
      name: " Din 7984 Low head allen bolt",
      category: "bolts",
      material: "MS | GI | SS | Yellow",
      Grade: "10.9 | 12.9 | 316 | 304",
      // price: 0.25,
      image: "./assets/ Din 7984 Low head allen bolt.jfif",
      description: "Metric | UNC | UNF",
    },
    {
      id: 19,
      name: " Din 7984 Low head allen bolt",
      category: "bolts",
      material: "MS | GI | SS | Yellow",
      Grade: "10.9 | 12.9 | 316 | 304",
      // price: 0.25,
      image: "./assets/ Din 7984 Low head allen bolt.jfif",
      description: "Metric | UNC | UNF",
    },
    {
      id: 20,
      name: " Din 7984 Low head allen bolt",
      category: "bolts",
      material: "MS | GI | SS | Yellow",
      Grade: "10.9 | 12.9 | 316 | 304",
      // price: 0.25,
      image: "./assets/ Din 7984 Low head allen bolt.jfif",
      description: "Metric | UNC | UNF",
    },
   
  ]
  
  // Products page functionality
  document.addEventListener("DOMContentLoaded", () => {
    let currentProducts = [...productsData]
    let currentPage = 1
    const productsPerPage = 12
  
    // Get DOM elements
    const productsGrid = document.getElementById("productsGrid")
    const searchInput = document.getElementById("searchInput")
    const searchBtn = document.getElementById("searchBtn")
    const categoryFilter = document.getElementById("categoryFilter")
    const materialFilter = document.getElementById("materialFilter")
    const sortFilter = document.getElementById("sortFilter")
    const pagination = document.getElementById("pagination")
  
    // Check if we're on the products page
    if (!productsGrid) return
  
    // Initialize products display
    initializeProducts()
  
    // Event listeners
    searchBtn.addEventListener("click", handleSearch)
    searchInput.addEventListener("keypress", (e) => {
      if (e.key === "Enter") {
        handleSearch()
      }
    })
  
    categoryFilter.addEventListener("change", applyFilters)
    materialFilter.addEventListener("change", applyFilters)
    sortFilter.addEventListener("change", applySorting)
  
    // Debounced search
    const debouncedSearch = window.FastenTechUtils.debounce(applyFilters, 300)
    searchInput.addEventListener("input", debouncedSearch)
  
    function initializeProducts() {
      // Check URL parameters for initial filters
      const urlParams = new URLSearchParams(window.location.search)
      const category = urlParams.get("category")
  
      if (category) {
        categoryFilter.value = category
        applyFilters()
      } else {
        displayProducts(currentProducts)
      }
    }
  
    function handleSearch() {
      applyFilters()
    }
  
    function applyFilters() {
      const searchTerm = searchInput.value.toLowerCase().trim()
      const selectedCategory = categoryFilter.value
      const selectedMaterial = materialFilter.value
  
      currentProducts = productsData.filter((product) => {
        const matchesSearch =
          !searchTerm ||
          product.name.toLowerCase().includes(searchTerm) ||
          product.description.toLowerCase().includes(searchTerm) ||
          product.Grade.toLowerCase().includes(searchTerm)
  
        const matchesCategory = !selectedCategory || product.category === selectedCategory
        const matchesMaterial = !selectedMaterial || product.material === selectedMaterial
  
        return matchesSearch && matchesCategory && matchesMaterial
      })
  
      applySorting()
      currentPage = 1
      displayProducts(currentProducts)
    }
  
    function applySorting() {
      const sortBy = sortFilter.value
  
      currentProducts.sort((a, b) => {
        switch (sortBy) {
          case "name":
            return a.name.localeCompare(b.name)
          case "price-low":
            return a.price - b.price
          case "price-high":
            return b.price - a.price
          case "category":
            return a.category.localeCompare(b.category)
          default:
            return 0
        }
      })
  
      displayProducts(currentProducts)
    }
  
    function displayProducts(products) {
      const startIndex = (currentPage - 1) * productsPerPage
      const endIndex = startIndex + productsPerPage
      const productsToShow = products.slice(startIndex, endIndex)
  
      if (productsToShow.length === 0) {
        productsGrid.innerHTML = `
                  <div style="grid-column: 1 / -1; text-align: center; padding: 3rem;">
                      <h3>No products found</h3>
                      <p>Try adjusting your search criteria or filters.</p>
                  </div>
              `
        pagination.innerHTML = ""
        return
      }
  
      productsGrid.innerHTML = productsToShow
        .map(
          (product) => `
              <div class="product-card">
                  <img src="${product.image}" alt="${product.name}" loading="lazy">
                  <div class="product-category">${capitalizeFirst(product.category)}</div>
                  <h3>${product.name}</h3>
                  <div class="product-material">Material: ${capitalizeFirst(product.material)}</div>
                  <p>${product.description}</p>
                  <div class="product-actions">
                      <button class="btn btn-primary" onclick="addToQuote(${product.id})">Add to Quote</button>
                      <button class="btn btn-outline" onclick="viewDetails(${product.id})">Details</button>
                  </div>
              </div>
          `,
        )
        .join("")
  
      displayPagination(products.length)
    }
  
    function displayPagination(totalProducts) {
      const totalPages = Math.ceil(totalProducts / productsPerPage)
  
      if (totalPages <= 1) {
        pagination.innerHTML = ""
        return
      }
  
      let paginationHTML = ""
  
      // Previous button
      paginationHTML += `
              <button ${currentPage === 1 ? "disabled" : ""} onclick="changePage(${currentPage - 1})">
                  Previous
              </button>
          `
  
      // Page numbers
      for (let i = 1; i <= totalPages; i++) {
        if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
          paginationHTML += `
                      <button class="${i === currentPage ? "active" : ""}" onclick="changePage(${i})">
                          ${i}
                      </button>
                  `
        } else if (i === currentPage - 3 || i === currentPage + 3) {
          paginationHTML += "<span>...</span>"
        }
      }
  
      // Next button
      paginationHTML += `
              <button ${currentPage === totalPages ? "disabled" : ""} onclick="changePage(${currentPage + 1})">
                  Next
              </button>
          `
  
      pagination.innerHTML = paginationHTML
    }
  
    // Global functions for product interactions
    window.changePage = (page) => {
      currentPage = page
      displayProducts(currentProducts)
  
      // Scroll to top of products section
      document.querySelector(".products-section").scrollIntoView({
        behavior: "smooth",
        block: "start",
      })
    }
  
    window.addToQuote = (productId) => {
      const product = productsData.find((p) => p.id === productId)
      if (product) {
        // Store in localStorage for quote page
        const quoteItems = JSON.parse(localStorage.getItem("quoteItems") || "[]")
  
        // Check if item already exists
        const existingItem = quoteItems.find((item) => item.id === productId)
        if (existingItem) {
          existingItem.quantity += 1
        } else {
          quoteItems.push({
            id: product.id,
            name: product.name,
            category: product.category,
            material: product.material,
            Grade: product.Grade,
            // price: product.price,
            quantity: 1,
          })
        }
  
        localStorage.setItem("quoteItems", JSON.stringify(quoteItems))
  
        // Show success message
        window.FastenTechUtils.showMessage(`${product.name} added to quote!`, "success")
  
        // Update quote button if it exists
        updateQuoteButton()
      }
    }
  
    window.viewDetails = (productId) => {
      const product = productsData.find((p) => p.id === productId)
      if (product) {
        // Create modal or redirect to product detail page
        showProductModal(product)
      }
    }
  
    function showProductModal(product) {
      const modal = document.createElement("div")
      modal.className = "modal-overlay"
      modal.innerHTML = `
              <div class="modal-content">
                  <div class="modal-header">
                      <h2>${product.name}</h2>
                      <button class="modal-close" onclick="window.closeModal()">&times;</button>
                  </div>
                  <div class="modal-body">
                      <img src="${product.image}" alt="${product.name}" style="width: 100%; max-width: 300px; margin-bottom: 1rem;">
                      <div class="product-details">
                          <p><strong>Category:</strong> ${capitalizeFirst(product.category)}</p>
                          <p><strong>Material:</strong> ${capitalizeFirst(product.material)}</p>
                          <p><strong>Grade:</strong> ${product.Grade}</p>
                          <p><strong>Description:</strong> ${product.description}</p>
                      </div>
                      <div class="modal-actions">
                          <button class="btn btn-primary" onclick="addToQuote(${product.id}); window.closeModal();">Add to Quote</button>
                          <button class="btn btn-secondary" onclick="window.closeModal()">Close</button>
                      </div>
                  </div>
              </div>
          `
  
      // Add modal styles
      const modalStyles = `
              <style>
                  .modal-overlay {
                      position: fixed;
                      top: 0;
                      left: 0;
                      width: 100%;
                      height: 100%;
                      background: rgba(0, 0, 0, 0.5);
                      display: flex;
                      justify-content: center;
                      align-items: center;
                      z-index: 2000;
                  }
                  .modal-content {
                      background: white;
                      border-radius: 12px;
                      max-width: 500px;
                      width: 90%;
                      max-height: 90vh;
                      overflow-y: auto;
                  }
                  .modal-header {
                      display: flex;
                      justify-content: space-between;
                      align-items: center;
                      padding: 1.5rem;
                      border-bottom: 1px solid #e5e7eb;
                  }
                  .modal-close {
                      background: none;
                      border: none;
                      font-size: 2rem;
                      cursor: pointer;
                      color: #64748b;
                  }
                  .modal-body {
                      padding: 1.5rem;
                  }
                  .modal-actions {
                      display: flex;
                      gap: 1rem;
                      margin-top: 2rem;
                  }
              </style>
          `
  
      document.head.insertAdjacentHTML("beforeend", modalStyles)
      document.body.appendChild(modal)
  
      // Close modal on overlay click
      modal.addEventListener("click", (e) => {
        if (e.target === modal) {
          window.closeModal()
        }
      })
    }
  
    window.closeModal = () => {
      const modal = document.querySelector(".modal-overlay")
      if (modal) {
        modal.remove()
      }
    }
  
    function updateQuoteButton() {
      const quoteItems = JSON.parse(localStorage.getItem("quoteItems") || "[]")
      const quoteBtn = document.querySelector(".quote-btn")
  
      if (quoteBtn && quoteItems.length > 0) {
        quoteBtn.textContent = `Request Quote (${quoteItems.length})`
      }
    }
  
    function capitalizeFirst(str) {
      return str.charAt(0).toUpperCase() + str.slice(1)
    }
  
    // Initialize quote button
    updateQuoteButton()
  })
  